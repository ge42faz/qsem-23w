\documentclass [10pt]{article}

\usepackage {amsmath}
\usepackage {amssymb}
\usepackage {multicol}
\usepackage [a4paper, total={16cm, 24cm}]{geometry}
\usepackage {titlesec}

\renewcommand {\thesection} {\Roman{section}} 
\renewcommand {\thesubsection} {\thesection.\Roman{subsection}}

\titleformat {\section}
  {\normalfont\normalsize\bfseries}{\thesection.}{1em}{}
\titleformat {\subsection}
  {\normalfont\normalsize\itshape}{\thesubsection.}{1em}{}
\titleformat {\subsubsection}
  {\normalfont\normalsize\itshape}{\thesubsubsection.}{1em}{}

\setlength {\columnsep}{0.5cm}

\DeclareMathOperator* {\argmin} {argmin}
\newcommand {\qvec}[1] {\vert #1 \rangle}
\newcommand {\qcovec}[1] {\langle #1 \vert}
\newcommand {\qeval}[1] {\langle #1 \rangle}
\newcommand {\qinner}[2] {\langle #1 \vert #2 \rangle}
\newcommand {\qouter}[2] {\qvec{#1} \qcovec{#2}}
\newcommand {\qnorm}[1] {\lVert #1 \rVert}


\title {
	Seminar: Advanced Topics in \\
	Quantum Computing \\
	On efficient encodings for QAOA \\
	solutions to vehicle routing problems
}
\author {Eben Jowie Haezer}
\date {\today}

\begin {document}
\maketitle

\begin {abstract}
This report details recent advances in the optimisation of computing resources
for quantum approaches to solving the vehicle routing problem (VRP) and 
its variants. This set of problems is of significant importance with regard
to logistical applications in industry. In accordance with the input
constraints of the quantum hardware, the problem is formulated as a quadratic
unconstrained binary optimisation (QUBO). A simple approach known as the
full encoding results in each solution represented by a unique basis state,
thereby requiring one qubit per classical variable. Due to this inefficiency
in resource allocation when considering the at worst factorial search space,
a more optimised minimal encoding is suggested that offers a logarithmic
reduction in necessary computing power. In spite of certain drawbacks incurred
by employing this minimal encoding, experiments have shown that the solution
quality is not heavily impacted.
\end {abstract}

\begin {multicols}{2}

% structure:
%
% i.	introduction
% ii.	vrp
% iii.	qubo
% iv.	algorithms
% v.	encoding schemes
% vi.	discussion
% vii.	conclusion
% viii.	appendix

\section {Introduction}
The Vehicle Routing Problem (VRP) is concerned with finding optimal routes
for vehicles to deliver goods to a set of customers with some geographical
distance between them. It is obvious that this type of problem has far
reaching practical applications in various contexts, in fact the need to find
a reasonable solution is almost ubiquitous when dealing with logistical
planning, for example to determine efficient road, rail, shipping, and air
routes for commercial or public interest.

VRP, being itself a more general version of the Travelling Salesman Problem
(TSP), is similarly an NP hard combinatorial optimisation problem with a
solution space scaling factorially in the number of customers, and thus
finding the definitive optimal solution already becomes intractable at
two digit customer counts. The most optimal classical algorithms known to date
and used in practice employ heuristics and greedy methods to construct routes
within single digit percentage tolerances.

More recently, the noisy intermediate scale quantum (NISQ) era has paved
the way for the development of variational quantum algorithms alongside the
potent quantum annealing method as a contender for computing reliable and
near optimal solutions to combinatorial optimisation problems, exploiting
the unique inherent property of quantum algorithms to operate on the
entire solution space at once, albeit incrementally and probabilistically.

Initial tests have shown some promise in applying these quantum algorithms
to the VRP against classical solvers, achieving comparable accuracy on
small problem instances. As quantum hardware continues to improve, it makes
sense to also look at utilising it as efficiently as possible. Solving VRP
naively using quantum methods maps one classical variable to one whole qubit,
quickly exhausting the already limited computing resources when introducing
additional constraints such as vehicle capacity or time windows on larger
problem scales more commonly encountered in practical scenarios.

This report discusses recent research into an idea to mitigate this
uneconomical use of computing power through a more clever and refined 
encoding of the input problem, in order to achieve a logarithmic correlation
between problem size and resource consumption.
Section II outlines a formal description of the VRP and some of its variants.
Section III explains the QUBO and its application to solving the VRP on
quantum hardware, along with a brief mention of the closely related
Ising model and in particular its Hamiltonian function.
Section IV details the encoding approaches onto the quantum system and lists
benefits and drawbacks for each.
Published experimental observations describing the impact of the encodings
are discussed in Section V,
and the report concludes in Section VI.

\section {Vehicle Routing Problem}
The vehicle routing problem (VRP) is a generalisation of the perhaps more
well known NP hard Travelling Salesman Problem (TSP). VRP seeks the optimal
route or routes for a number of vehicles to traverse in order to deliver
certain goods to customers in various locations.

The problem is modelled intuitively by a graph $G = (V, E)$
where each node or vertex $v_i \in V$ represents the location of a customer 
and each edge $(i, j) \in E$ connecting two vertices corresponds to a path
traversible by a delivery vehicle. $\qnorm{V} = N$ is then the number
of customers considered. Traversing an edge $(i, j)$ typically incurs
a cost represented by $c_{ij} \in \mathbb R_{\ge 0}$, of which the total
value summed up across the entire journey is to be optimised, ie. made as
small as possible. This cost may be set based on travel time, distance,
or other concerns with economic consequences.

Vehicles may only travel across edges. Furthermore, each graph contains a
designated node $v_0 \in V$ known as the depot. Valid routes must always
begin and end at the depot. A valid route is then a tuple
$r = (v_n, v_{n+1}, ..., v_m)$ s.t.
$v_n = v_m = v_0 \; \land \; \forall n. \; (v_n, v_{n+1}) \in E$.

For a problem to be classified as VRP, it should fulfil at least the above
minimal constraints. However, additional constraints may be imposed as
needed to better reflect a practical use case at the expense of slightly
complicating the model. For example, the capacitated VRP or CVRP stipulates
a fixed upper bound on the carrying capacity of each vehicle leaving the
depot, where in most cases this value is consistent across all vehicles.
Customers $v_i$ are then assigned a score $d_i \in \mathbb R_{\ge 0}$ 
reflecting their demand quantity. This introduces the complication of
optimising for capacity and demand as well as edge cost, and the ideal
solution for a given graph will most likely differ from the simple VRP.

On the other hand, the VRP with time windows (VRPTW) introduces a secondary
time parameter. Customers $v_i$ are assigned a certain time window
$[t_i^0, t_i^f] \subseteq \mathbb R_{\ge 0}$ in which they expect a delivery.
For the depot $v_0$ this interval is $[0, \infty)$ for simplicity. Hence the
edge costs $c_{ij}$ represent travel time between two nodes in this
formulation, and the objective shifts to finding the optimal route that
serves all customers whilst respecting these time windows, or failing this
attempting to maximise the number of customers or total goods supplied.

\section {Problem Formulation}
The quadratic unconstrained binary optimisation (QUBO) is concerned with
finding a binary vector $\qvec{x^*} \in \{0, 1\}^n$, $n \in \mathbb N$ that
fulfils the following optimal condition:
\begin {equation}
\qvec{x^*} = \argmin_{\qvec{x} \in \{0, 1\}^n} \; \qcovec{x} Q \qvec{x}
\end {equation}
where the linear operator $Q \in \mathbb R^{n \times n}$ is a symmetric
matrix. This can be interpreted as an objective function:
\begin {equation}
\label {qubo}
f_Q(x) = \qcovec{x} Q \qvec{x} =
\sum_{i = 1}^n \sum_{j = i}^n Q_{ij} x_i x_j
\end {equation}

In general, QUBO is also NP hard due to the exponential scaling of the
solution space in $\qnorm{\{0, 1\}^n} \in \mathcal{O}(2^n)$ with respect
to the number of dimensions $n$. Many combinatorial optimisation problems have
conversions into QUBO \cite{isingnp} \cite{tutqubo}, not least the VRP and its
variants. These conversions
are useful to establish a uniform problem description for solvers to work with,
however in the context of quantum solvers, they are further motivated by the 
equivalence between QUBO and the Hamiltonian of the Ising model for
ferromagnetism in particle physics.

The Ising model describes a lattice structure $\Lambda$ in which each lattice
site houses a particle. The spin of each particle is represented by a discrete
variable $\sigma_i \in \{-1, 1\}$, $i \in \Lambda$. This spin value governs the
local magnetic moment of the particle according to the shell model (appendix).
Neighbouring lattice sites $\qeval{i\;j}. \; i, j \in \Lambda$ influence each
other, termed nearest neighbour interactions, whose interaction strength is
represented by $J_{ij} \in \mathbb R$. Furthermore, one may consider the
influence of an external field $h_i$ at site $i \in \Lambda$, such that the
spin wants to align with this field.

Thus the Hamiltonian reads:
\begin {equation}
H = - \sum_{\qeval{i\;j}} J_{ij} \sigma_i \sigma_j - \mu \sum_{i} h_i \sigma_i
\end {equation}
where $\mu$ is the magnetic moment.

Replacing $\sigma$ with the Pauli operators yields the
quantum mechanical description:
\begin {equation}
H = - \sum_{\qeval{i\;j}} J_{ij} \sigma_i^z \sigma_j^z
- \mu \sum_{i} h_i^z \sigma_i^z - \mu \sum_{i} h_i^x \sigma_i^x
\end {equation}
where the second term with $\sigma^z$ describes the external longitudinal
field, and the final term with $\sigma^x$ describes the transverse field per
lattice site.

Notably, the Ising model is typically simplified to exclude the transverse
field, resulting in a classical Hamiltonian where the constituent terms
commute ie. a diagonal operator in the $Z$ basis. This means the
ground state is described by a basis vector $\qvec{\phi}$ with
$\phi \in \{0, 1\}^n$, allowing for simple measurement to obtain a bit
string solution.

Through the reversible transformation $\sigma \mapsto 2x - 1$, where
$x \in \{0, 1\}$ s.t. $-1 \mapsto 0$ and $1 \mapsto 1$, one
obtains the equivalent QUBO formulation for free, and hence optimising for 
the ground state of the Ising Hamiltonian is equivalent to optimising the
QUBO objective function.

With this knowledge, one can formulate the VRP as follows. We define the
set of constraints that a valid solution must adhere to:
\begin {itemize}
\item[\textbf{once}] Each customer $v_i$ in a route $r_j$ is visited exactly
	once.
\item[\textbf{step}] For each time step, each vehicle is either at a customer
	node $v_i$ or at the depot $v_0$.
\end {itemize}

Additional constraints may be specified depending on the problem variant.
For CVRP the following is useful:
\begin {itemize}
\item[\textbf{cap}] All routes $\{r_i\}$ respect the maximum capacity
	$m \in \mathbb R$ of a vehicle.
\end {itemize}

Note that for simplicity, we do not distinguish between vehicles and routes,
under the premise that each route will be navigated by exactly one vehicle.
Since in CVRP the routes are optimised for the vehicle capacity $m$, assuming
homogenous vehicles this simplification is unlikely to affect the final
result. Furthermore, some CVRP variants consider multiple depot nodes. This
variant will also not be further investigated here.

Let $x_{t, i}^r \in \{0, \; 1\}$ denote the assignment of the customer node
$v_i$ to be visited along route $r \in \mathbb N_0$ at time step
$t \in \mathbb N_0$.
The first two constraints can then be described mathematically as follows:

\begin {equation}
H_{\text{once}} = \sum_i \; (1 - \sum_{r, \; t} x_{t, i}^r)^2
\end {equation}

\begin {equation}
H_{\text{step}} = \sum_{r, \; t} \; (1 - \sum_i x_{t, i}^r)^2
\end {equation}

The idea is to coerce each squared term to evaluate to zero, implying each
inner summation should evaluate to one. To illustrate, consider for example
$H_{\text{step}}$ which encodes the constraint \textbf{step}. We sum over all
node indices $i$, such that for a given step $t$ along the route $r$,
precisely one customer node or the depot is assigned to the schedule. In
general, once a constraint is violated it follows that the calculation yields
a positive result, after which penalty values may be applied accordingly.

Encoding the constraint \textbf{cap} is a little more involved:
\begin {equation}
H_{\text{cap}} = \sum_r \big( m - (\Delta + \sum_{t, \; i} d_i x_{t, i}^r) \big) ^2
\end {equation}
where $d_i$ represents the demand score of node $v_i$ and
\begin {equation}
\Delta = \sum_{b=0}^{\lceil \log_2 1+m \rceil - 1} 2^b \; a_b^r
\end {equation}

While the principle remains identical to the first two constraints,
The additional term $\Delta$ in $H_{\text{cap}}$ is a result of \textbf{cap}
being somewhat more relaxed, in that any value
$\sum_{t, \; i} d_i x_{t, i}^r \leq m$
for the loading of the vehicle is acceptable, instead of a hard requirement.
This is conveyed through the auxiliary variables $a_b^r \in \{0, \; 1\}$,
which may be freely set to perfectly zero out unused vehicle capacity for the
route $r$. Intuitively, $\Delta$ represents the tolerable deviation of the
amount loaded onto the vehicle on route $r$ compared to maximum capacity.
Naturally not fully loading the vehicle and forcing an early return to depot
may be suboptimal in many cases, however the edge cost metric represented by
the objective function $H_c$ is sufficient to deter this.

Coupled with the objective function given by $H_c$, the complete CVRP
Hamiltonian is the linear combination of these constraints:
\begin {equation}
\label {hcvrp}
H_p = H_c + p_1 H_{\text{once}} + p_2 H_{\text{step}} + p_3 H_{\text{cap}}
\end {equation}
Here $p_k \in \mathbb R_{\ge 0}$ with $k \in \{1, 2, 3\}$ corresponds to a
large penalty value that serves to mark a potential solution as undesirable,
in the case that one or more of the corresponding constraints are violated.
The exact values of $p_k$ are dependent on the problem instance and must be
heuristically determined and optimised.

Crucially, this description of the CVRP is only one of several possible
formulations. Extensive research has been conducted into determining the most
optimal description that benefits solution quality as well as speed of
convergence. In particular, the formulation in \eqref{hcvrp} turns out not to
be suitable with regard to current limitations of NISQ era processors, due to
the large amount of free binary variables and comparative lack of computing
resources available to account for them all. The CVRP must as a result be
split into two distinct phases, a clustering phase that groups customer nodes
together similar to the knapsack problem, and a routing phase to determine the
ideal route in each of these clusters as in the TSP.

\section {Quantum Algorithms}
Traditionally, quantum solvers for combinatorial optimisation problems have
been implemented using the quantum annealing approach. This method relies on
the theory of adiabatic quantum computation to evolve a prepared system state
of the Hamiltonian $H_0$ gradually towards the problem Hamiltonian $H_p$. With
sufficiently slow evolution, the system is guaranteed to arrive in the ground
state by the adiabatic theorem.

More precisely, the system evolves according to
\begin {equation}
H(t) = \left(1 - \frac{t}{T}\right) \cdot H_0 + \frac{t}{T} \cdot H_p
\end {equation}
with $0 \leq t \leq T$, where the total algorithm runtime $T$ is bound by
$T \in \mathcal{O}(\frac{1}{g^2})$. Here $g$ denotes the spectral gap of $H$,
the minimal energy difference between the ground state and first excited
state throughout the evolution. Consequently, Hamiltonians with narrower
spectral gaps have to be evolved more slowly for the sake of precision.

On the other hand, the more common circuit model processor operates based on a
series of quantum gates connected in a circuit in order to manipulate the
quantum state to a desired outcome. This principle of operation is founded
upon the discretised solution to the Schrödinger equation for negligibly small
time intervals:
\begin {equation}
i \hbar \frac{\partial}{\partial t} \qvec{\psi(t)} = H \qvec{\psi(t)}
\Longleftrightarrow
U(t) = e^{\frac{-i}{\hbar}Ht}
\end {equation}
where $U$ denotes the unitary time evolution operator. This unitary can be
decomposed into several building blocks termed quantum gates, which are
implemented in the hardware and operate on a small subset of qubits. The
quantum circuit thus realises the Hamiltonian.

The advances in circuit model quantum processors that have brought
about the NISQ era have offered an alternative approach to tackle optimisation
problems, namely that of supplementing a quantum algorithm with classically
tuned parameters to iteratively arrive at a good approximation of the ground
state, known as variational algorithms. NISQ era processors are characterised
by a primary limitation of restricted circuit depth due to their sensitivity
to noise as well as the inability to correct the faults introduced. By
offloading some of the computation to a classical algorithm and proceeding
iteratively, this limitation can be worked around to a degree that allows
one to obtain reasonable estimations of the ideal solutions to optimisation
problems.


\section {Encoding Approaches}
We assume the use of a conventional NISQ processor to tackle a VRP involving
$n_c$ classical binary variables. A simple mapping from the VRP to QUBO uses
what is known as the complete encoding, where each classical binary variable
is represented by a single qubit. The quantum state takes the form:
\begin {align}
\qvec{\psi(\theta)} 
&= U(\theta)\qvec{\psi_0} \\
&= \sum_{x \in \{0, \; 1\}^{n_c}} \alpha_x \qvec{x}
\end {align}

In this case, sampling the quantum state yields any given bitstring solution
${x \in \{0, \; 1\}^{n_c}}$ with probability $\qnorm{\alpha_x}^2$, where
$\alpha$ is parametrised by a set of angles $\theta$. In variational
algorithms, $\theta$ are heuristically determined values that serve to tune
arrays of rotation unitaries, which are adjusted after each pass to attain
the optimised state $\qvec{\psi^*} = U(\theta^*)\qvec{\psi_0}$.

The QUBO objective function in the complete encoding is described by the
expectation of the equivalent Ising Hamiltonian:
\begin {equation}
C_{cpl}(\theta) = \qeval{H} = \qcovec{\psi(\theta)} H \qvec{\psi(\theta)}
\end {equation}


The advantage of the complete encoding is its ability to capture all
possible correlations between classical variables. This however sacrifices
scalability, requiring computational resources that scale proportionally
to the problem size as each binary classical variable is mapped to a
single qubit, hence $n_q = n_c$. As a result, feasible applications of the
complete encoding are limited to toy examples. Even as quantum hardware
becomes more powerful, it is prudent to examine encoding schemes that can more
efficiently take advantage of the available technology.

We consider the minimal encoding as presented in \cite{effbinopt}. This scheme
allows for $n_c$ classical variables to be mapped to $n_q = 1 + \log_2 n_c$
qubits, using a $n_r = \log_2 n_c$ wide register and $n_a = 1$ auxiliary
qubit.

Let $\{\qvec{\phi_i}\}$ and $\{\qvec{0}, \qvec{1}\}$ denote a basis for the
register and auxiliary qubits respectively. The system state $\qvec{\psi}$ is
then defined as:
\begin {equation}
\qvec{\psi(\theta)} = \sum_{i=1}^{n_c} \beta_i
(a_i \qvec{0} + b_i \qvec{1}) \; \qvec{\phi_i}
\end {equation}
where the coefficients $\beta_i$, $a_i$, $b_i$ are parametrised by $\theta$,
as in the complete encoding.

This encodes in the register the probability $\beta_i$ of measuring each
register state $\qvec{\phi_i}$ that corresponds to an individual classical
variable $x_i$, and in the auxiliary the probability of each of these binary
variables taking on the value $0$ or $1$ according to the Born rule:
$\Pr \; (x_i = 0) = \qnorm{a_i}^2$ and $\Pr \; (x_i = 1) = \qnorm{b_i}^2$.
Taken together, the probability of measuring a certain bitstring solution
$x$ for a given $\theta$ is expressed by:
\begin {equation}
\label {prob}
\Pr x = \prod_{i=1}^{n_c} \Pr x_i = \prod_{i=1}^{n_c} \qnorm{b_i}^2
\end {equation}

As an example, consider $n_c = 4$, $n_r = 2$. The normalised system
state representing a particular bitstring $x^* = (1, 1, 1, 0)^\dag$
would be $\qvec{\psi^*} = \frac{1}{2}(\qvec{1}\qvec{00} + \qvec{1}\qvec{01}
+ \qvec{1}\qvec{10} + \qvec{0}\qvec{11})$.

The variational algorithm is run for several trials to obtain an estimate
of the coefficients $a_i$ and $b_i$, from which the probability distribution
for bitstring solutions as given in \eqref{prob} may be constructed.

As stated previously, with the minimal encoding a logarithmic scaling of
qubits to classical variables is achieved. However, this comes at the
expense of a more limited expressiveness in the quantum state. As seen in
\eqref{prob}, the probability distribution is sufficient to encode only
statistically independent classical variables, ie. those s.t.
$\forall i \; j. \; \Pr \; (x_i \land x_j) = \Pr x_i \Pr x_j$, which tend
not to be the case for highly complex and intertwined problems as in the VRP.

Furthermore, the number of trials required to obtain a solution of sufficient
quality is necessarily increased. Depending on the exact problem
configuration, particularly small coefficient values in the quantum state
may result in certain bitstring outcomes being sampled too infrequently if at
all while evaluating the objective function, leading to inaccuracies.
% TODO

Substituting \eqref{prob} into \eqref{qubo} and incorporating the
probabilistic component, we obtain the following objective function for the
minimal encoding:
\begin {align}
C_{min}(\theta)
&= \sum_{i \neq j}^{n_c} Q_{ij} \qnorm{b_i}^2 \qnorm{b_j}^2
+ \sum_{i=1}^{n_c} Q_{ii} \qnorm{b_i}^2 \\
&= \sum_{i \neq j}^{n_c} Q_{ij}
\frac{\qeval{P_i^1}}{\qeval{P_i}} \frac{\qeval{P_j^1}}{\qeval{P_j}}
+ \sum_{i=1}^{n_c} Q_{ii} \frac {\qeval{P_i^1}} {P_i}
\end {align}
expressed as projectors $P_i = \qouter{\phi_i}{\phi_i}$ and
$P_i^1 = \qouter{1}{1} \otimes P_i$.
% TODO linearity

\section {Discussion}

\section {Conclusion}

\bibliographystyle {IEEEtran}
\bibliography {report}

\appendix

\end {multicols}

\end {document}

